(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{408:function(e,t,a){"use strict";a.r(t);var i=a(46),s=Object(i.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"adding-decoders"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adding-decoders"}},[e._v("#")]),e._v(" Adding decoders")]),e._v(" "),a("p",[e._v("Adding your device protocol to Theengs decoder enable to increase interoperability and to create new use cases with your device. You will find below some guidance to do that.")]),e._v(" "),a("p",[e._v("You can do a pull request directly to the "),a("a",{attrs:{href:"https://github.com/theengs/1decoder",target:"_blank",rel:"noopener noreferrer"}},[e._v("Repository"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h1",{attrs:{id:"adding-device-decoding"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adding-device-decoding"}},[e._v("#")]),e._v(" Adding device decoding")]),e._v(" "),a("p",[e._v("Device decode specifications are located in a json file, example "),a("a",{attrs:{href:"../../src/device_json.h"}},[e._v("HHCCJCY01HHCC_json.h")]),e._v(". The format is:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('R""""(\n{\n   "brand":"Xiaomi",\n   "model":"miflora",\n   "model_id":"HHCCJCY01HHCC",\n   "condition":["servicedata", "contain", "209800"],\n   "properties":{\n      "tempc":{\n         "condition":["servicedata", 25, "4"],\n         "decoder":["value_from_hex_data", "servicedata", 30, 4, true],\n         "post_proc":[\'/\', 10]\n      },\n      "moi":{\n         "condition":["servicedata", 25, "8"],\n         "decoder":["value_from_hex_data", "servicedata", 30, 2, false]\n      },\n      "lux":{\n         "condition":["servicedata", 25, "7"],\n         "decoder":["value_from_hex_data", "servicedata", 30, 6, true]\n      },\n      "fer":{\n         "condition":["servicedata", 25, "9"],\n         "decoder":["value_from_hex_data", "servicedata", 30, 4, true]\n      }\n   }\n})"""",\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br"),a("span",{staticClass:"line-number"},[e._v("25")]),a("br"),a("span",{staticClass:"line-number"},[e._v("26")]),a("br")])]),a("p",[e._v("Each device must provide a "),a("code",[e._v("brand")]),e._v(", "),a("code",[e._v("model")]),e._v(", "),a("code",[e._v("model_id")]),e._v(", "),a("code",[e._v("condition")]),e._v(", and "),a("code",[e._v("properties")]),e._v(".")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("brand")]),e._v(" = brand name of the device.")]),e._v(" "),a("li",[a("code",[e._v("model")]),e._v(" = model name of the device.")]),e._v(" "),a("li",[a("code",[e._v("model_id")]),e._v(" = model id number of the device.")])]),e._v(" "),a("h3",{attrs:{id:"condition"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#condition"}},[e._v("#")]),e._v(" Condition")]),e._v(" "),a("p",[a("code",[e._v("condition")]),e._v(" is a JSON array, which must contain as the first parameter, the data source to test for the condtion. Valid inputs are:")]),e._v(" "),a("ul",[a("li",[e._v('"servicedata"')]),e._v(" "),a("li",[e._v('"manufacturerdata"')]),e._v(" "),a("li",[e._v('"name"')]),e._v(" "),a("li",[e._v('"uuid"')])]),e._v(" "),a("p",[e._v("The second parameter is how the data should be tested. Valid inputs are:")]),e._v(" "),a("ul",[a("li",[e._v('"contain" tests if the specified value (see below) exists the data source')]),e._v(" "),a("li",[e._v('"index" tests if the specified value exists at the index location (see below) in the data source')])]),e._v(" "),a("p",[e._v("The third parameter can be either the index value or the data value to find. If the second parameter is "),a("code",[e._v("contain")]),e._v(", the third parameter should be the value to look for in the data source. If the second parameter is "),a("code",[e._v("index")]),e._v(", the third parameter should be the location in the data source to look for the value provided as the fourth parameter.")]),e._v(" "),a("p",[a("code",[e._v("condition")]),e._v(" can have multiple conditions chanined together using '|' and '&' between them."),a("br"),e._v("\nFor example: "),a("code",[e._v('"condition":["servicedata", "index", 0, "0804", \'|\', "servicedata", "index", 0, "8804"]')]),a("br"),e._v('\nThis will match if the service data at index 0 is "0804" '),a("code",[e._v("OR")]),e._v(' "8804".')]),e._v(" "),a("h3",{attrs:{id:"properties"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#properties"}},[e._v("#")]),e._v(" Properties")]),e._v(" "),a("p",[e._v("Properties is a nested JSON object containing one or more JSON objects. In the example above it looks like:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(' "properties":{\n      "tempc":{\n         "condition":["servicedata", 25, "4"],\n         "decoder":["value_from_hex_data", "servicedata", 30, 4, true],\n         "post_proc":[\'/\', 10]\n      },\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("p",[e._v('Here we have a single property that defines a value that we want to decode. The key "tempc" will be used as the key in the JsonObject provided when '),a("code",[e._v("decodeBLEJson(JsonObject)")]),e._v(' is called. "tempc" in this example is another JSON object that has an (optional, explained below) '),a("code",[e._v("condition")]),e._v(", "),a("code",[e._v("decoder")]),e._v(", and "),a("code",[e._v("post_proc")]),e._v(".")]),e._v(" "),a("p",[a("code",[e._v("condition")]),e._v(" is a JSON array. The first parameter defines the data source of the condition to test and must be one of:")]),e._v(" "),a("ul",[a("li",[e._v('"servicedata"')]),e._v(" "),a("li",[e._v('"manufacturerdata"')])]),e._v(" "),a("p",[e._v("The second parameter is the index of the data source to look for the value. The third parameter is the value to test for.\nIf the condition is met the data will be decoded and added to the JsonObject.")]),e._v(" "),a("p",[a("code",[e._v("decoder")]),e._v(' is a JSON array that specifies the decoder function and parameters to decode the value. The first parameter is the name of the function to call, currently only "value_from_hex_data" is valid. The other parameters are:')]),e._v(" "),a("ul",[a("li",[e._v('"servicedata", Extract the value from the service data. Could also be "manufacturerdata"')]),e._v(" "),a("li",[e._v("30, The index of the data source where the value exists.")]),e._v(" "),a("li",[e._v("4, The length of the data in bytes (characters in the string).")]),e._v(" "),a("li",[e._v("true/false, If the value in the data source should have it's endianness reversed before converting.")]),e._v(" "),a("li",[e._v("(optional)true/false, Sets if the resulting value can be a negative number.")])]),e._v(" "),a("p",[a("code",[e._v("post_proc")]),e._v(" This specifies any post processing of the resulting decoded value. This is a JSON array that should be written in the order that the operation order is desired. In the simple example the first parameter is the '/' divide operation and the second parameter (10) is the value to divide the result by. Multiple operations can be chained together in this array to perform more complex calculations. Valid operations are:")]),e._v(" "),a("ul",[a("li",[e._v("'/' divide")]),e._v(" "),a("li",[e._v("'*' multiply")]),e._v(" "),a("li",[e._v("'+' add")]),e._v(" "),a("li",[e._v("'-' subtract")]),e._v(" "),a("li",[e._v("'%' modulo")]),e._v(" "),a("li",[e._v("'<' shift left")]),e._v(" "),a("li",[e._v("'>' shift right")]),e._v(" "),a("li",[e._v("'!' Not (invert), useful for bool types")])]),e._v(" "),a("p",[a("code",[e._v("val_bits")]),e._v(" (Not shown in the example) is an additional parameter that can be added to define the value. It will convert the post processed result into a value with the number of bits specified by "),a("code",[e._v("val_bits")]),e._v(". Valid values are: 1 (for bool), 8, 16, 32. Double is the default type if this is omitted.")])])}),[],!1,null,null,null);t.default=s.exports}}]);